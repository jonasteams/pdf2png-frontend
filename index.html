<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PNG ↔ PDF Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">

  <!-- NAVBAR -->
  <nav class="bg-white shadow-md fixed w-full top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <img src="static/logo.png" alt="Logo" class="w-40 h-10">
      </div>
      <div class="flex-1 flex justify-center space-x-6">
        <a href="?tab=pdf2png" class="text-gray-700 hover:text-blue-500 font-medium">PDF → PNG</a>
        <a href="?tab=png2pdf" class="text-gray-700 hover:text-blue-500 font-medium">PNG → PDF</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="pt-40 max-w-3xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-6">Convert Your File Free</h1>

    <div class="bg-white p-6 rounded-2xl shadow-md text-center">
      <input id="fileInput" type="file" class="mb-4" multiple />
      <select id="tabSelect" class="mb-4 px-2 py-1 rounded border">
        <option value="pdf2png">PDF → PNG</option>
        <option value="png2pdf">PNG → PDF</option>
      </select>
      <button onclick="uploadFiles()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600">
        Upload & Convert
      </button>
      <p id="status" class="mt-4 text-gray-600"></p>
      <a id="downloadLink" class="hidden mt-4 text-blue-600 font-bold underline"></a>
    </div>
  </main>

  <script>
    const backendURL = "https://pdf2png-5f8y.onrender.com";

    async function uploadFiles() {
      const files = document.getElementById("fileInput").files;
      const tab = document.getElementById("tabSelect").value;

      if (files.length === 0) {
        alert("Please select at least one file.");
        return;
      }

      const formData = new FormData();
      formData.append("tab", tab);

      if (tab === "pdf2png") {
        formData.append("file", files[0]); // PDF → PNG : un seul fichier
      } else {
        for (let i = 0; i < files.length; i++) {
          formData.append("files", files[i]); // PNG → PDF : multiple fichiers
        }
      }

      document.getElementById("status").innerText = "Uploading & converting...";
      document.getElementById("downloadLink").classList.add("hidden");

      try {
        const res = await fetch(`${backendURL}/convert`, {
          method: "POST",
          body: formData
        });

        if (!res.ok) throw new Error(`Conversion failed: ${res.statusText}`);

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);

        const downloadLink = document.getElementById("downloadLink");
        downloadLink.href = url;
        downloadLink.download = tab === "pdf2png" ? "converted.zip" : "converted.pdf";
        downloadLink.innerText = "⬇ Download your file";
        downloadLink.classList.remove("hidden");
        document.getElementById("status").innerText = "Conversion complete!";
      } catch (err) {
        document.getElementById("status").innerText = "Error: " + err.message;
      }
    }
  </script>
</body>
</html>
